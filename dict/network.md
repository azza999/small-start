# 네트워크

## OSI 7계층

### 전송 계층과 네트워크 계층의 차이

전송 계층은 종단간의 전송을 보장하는 것이고, 네트워크 계층은 각 장비간(peer to peer)의 전송을 보장하는 것이다.

우리가 웹 페이지를 열어볼 때, 서버에서 데이터를 제대로 수신 받았는지 확인하는 것은 전송 계층의 일이고,

서버에서 우리의 PC까지 오는 길(라우팅)을 결정하는 것은 네트워크 계층의 일이다.

### LG bit와 IG bit (TCP)

_LG bit_

Default MAC 주소인지 자체적으로 부여한 주소인지를 식별하는 FLAG

_IG BIT_

TCP에서 멀티캐스트 통신과 유니캐스트 통신을 구분하는 FLAG


※ 질문 : MAC 주소에서 LG bit와 IG bit가 변한다면, 원본 MAC 주소에도 영향을 주는거 아닌가요?

LG bit가 변한다면 이미 변한 MAC 주소이고, IG bit가 변할 때는 브로드캐스트 이거나(FF:FF:FF:FF:FF:FF), 멀티캐스트 주소를 사용하므로 원본 MAC 주소는 변할 일이 없다.


## 포트 (Port)

포트는 우리말로 항구이다. 소프트웨어가 들어오는 데이터를 실은 화물선을 위해 열어두는 항구이다. 포트의 구성은 다음과 같다.

_Well-Known Port (0 ~ 1023)_
잘-알려진 포트는 강제적이지 않지만, 주로 사용되는 포트들이다. 대부분의 유닉스 계열의 운영체제의 경우 root 권한 없이는 사용할 수 없다.

_Registerd Port (1024 ~ 49151)_
예약된 포트는 운영체제에서 지속적으로 서비스해야하는 프로세스가 주로 사용하는 포트이다.

_Dynamic Port (49152 ~ 65535)_
동적 포트는 주로 요청할때 사용하는 비교적 주기가 짧은 포트이다.

_참고 사항_
결론부터 말하자면 포트의 범위는 아무 상관 없다. ssh가 22번 포트를 사용하더라도, 일반 사용자들의 ssh 요청을 줄이기 위해 (물론 포트 스캐닝으로 쉽게 ssh가 어떤 포트를 사용하는지 알 수 있다.) 50293번 포트를 사용할 수도 있고, 기존의 22번 포트를 해당 포트에 접근한 사용자들을 파악하기 위한 보안 프로그램에 할당할 수도 있다. 포트번호는 그저 겹치지 않기만 하면 된다.


## TCP Flag

_SYN (syncronization)_
연결 요청 플래그
세션 정립시 가장 먼저 전송하고, 시퀀스 번호를 설정하고

_ACK (Acknowledgement)_
응답 플래그

_RST (Reset)_




## FTP (File Transport Protocol)

_Active FTP vs Pasive FTP_

FTP의 동작 모드는 두가지이다.

Active FTP  

FTP를 서버측에서 살펴보면 기본적으로 20, 21번 포트를 사용한다. 20번 포트는 데이터가 직접적으로 오고 가는 포트이고, 21번 포트는 명령이 오고가는 제어 포트이다. 클라이언트는 21번 포트를 사용하여 서버와의 연결을 구축하고 제어 명령어를 전송한다. 이에 따라 20번 포트에서는 데이터의 직접적인 이동이 이루어진다.

클라이언트 측에서 살펴보면, 처음 서버측의 21번 포트로 데이터를 받을 포트를 넘겨준다. 서버는 ACK Flag와 함께 클라이언트의 포트에 접속 요청을 하고, 클라이언트가 요청에 대한 ACK Flag를 전송하면 해당 포트와 서버간에 정보 교환이 이루어진다. 따라서, 클라이언트의 보안 설정에 따라, 클라이언트의 포트가 막혀 정보 전송이 불가능할 수 있다. (서버가 클라이언트에 접속)

Passive FTP

Passive FTP도 클라이언트의 요청까지는 같다. 하지만 서버는 21번 포트에서 요청을 수신시 서버측에서 사용할 포트를 클라이언트에게 전달하고, 클라이언트는 해당 포트로 접속을 시도한다. 따라서 Active FTP와는 달리 클라이언트가 서버로 접속하는 방식이다.



### TFTP, SFTP, FTPS

_TFTP_

TFTP는 Trivial FTP로써 UDP 프로토콜로 파일 전송이 이루어진다. 따라서 파일의 무결성을 보장하지는 않지만, 더 빠르고 간단하게 이루어진다.

* 읽기
클라이언트는 서버에 파일명과 함꼐 read request를 보내고, 서버는 이에 바로 파일을 보내 준다.

* 쓰기
마찬가지로 클라이언트는 파일과 함께 쓰기 요청을 보내고, 서버는 잘 받았다는 내용을 답신한다.


_SFTP_

sftp는 ssh의 FTP 버전이다. ssh와 동일하게 사전의 키 교환으로 암호화된 ssh 세션을 만들어 파일을 주고받는 프로토콜이다.

_FTPS_

ftps는 ssl의 FTP 버전이다. SSL와 동일하게 인증서를 통하여 메시지 교환에서 위/변조가 없음을 보장한다.


## SSH와 SSL의 차이 

_SSH (Secure SHell)_


_SSL (Secure Sockets Layer)_
 클라이언트가 서버에 접속하게되면, 서버는 클라이언트에게 인증서를 전송한다. 클라이언트는 인증서를 검증하고, 인증서의 공개키를 이용해 session key로 사용할 문자열을 서버에 공개키로 암호화 후 전송한다. 이를 이용해, 대칭키 암호화 방식으로 메세지를 암호화하여 교환한다.